# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

#### Типы перечислений

###### Категория товара

```
type TCategory =
	| 'софт-скил'
	| 'другое'
	| 'дополнительное'
	| 'кнопка'
	| 'хард-скил';
```

###### Способ оплаты

```
type TPayment = 'online' | 'offline';
```

#### Интерфейсы данных

###### Товар

```
interface IItem {
	id: string;
	title: string;
	image: string;
	price: number | null;
	description: string;
	category: TCategory;
}
```

###### Список товаров

```
interface IItemList{
	total: number;
	items: IItem[];
}
```

###### Контактные данные

```
interface IContactData{
	email: string;
	phone: string;
}
```

###### Способ оплаты и адрес доставки

```
interface IPaymentData{
	address: string;
	payment: TPayment;
}
```

###### Данные заказа

```
type IOrder = IContactData & IPaymentData
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой представления отвечает за отображение данных на странице
- слой данных отвечает за хранение и изменение данных
- презентер отвечает за связь представления и данных

## Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах эндпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на эндпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков
о наступлении события.
Класс имеет методы on, off, emit — для подписки на событие, отписки от события и уведомления
подписчиков о наступлении события соответственно.
Дополнительно реализованы методы onAll и offAll — для подписки на все события и сброса всех
подписчиков.
Интересным дополнением является метод trigger , генерирующий заданное событие с заданными
аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти
классы будут генерировать события, не будучи при этом напрямую зависимыми от класса EventEmitter.

## Слой Данных

#### Class ItemsData

Класс отвечает за хранение и работу с массивом товаров.
Конструктор класса принимает инстанс брокера событий.

###### Поля класса

- items: IItem[] – массив товаров
- preview: string | null – ID товара, выбранного для просмотра в модальном окне.
- events: IEvents – экземпляр класса EventEmitter для инициализации событий при изменении данных

###### Методы класса

- getItem(id: string):IItem – возвращает объект товара по его ID.
- сеттеры и геттеры для полей класса c генерацией событий у сеттера items и сеттера preview.

#### Class CartData

Отвечает за хранение и управление товарами в корзине, а также их общей стоимостью.
Конструктор класса принимает инстанс брокера событий.

###### Поля класса

- items: IItem[] - массив товаров в корзине
- events: IEvents – экземпляр класса EventEmitter для инициализации событий при изменении данных

###### Методы класса

- addItem(item:IItem):void – добавляет товар в корзину. Вызывает событие изменения корзины.
- removeItem(id:string):void – удаляет товар из корзины. Вызывает событие изменения корзины.
- hasItem(id:string):boolean – проверяет наличие товара в корзине по id
- getItemsLength():number – возвращает число товаров в корзине.
– clear():void – очищает корзину, генерирует событие изменения корзины.
- getTotal():number – вычисляет итоговую стоимость товаров в корзине.

#### Class OrderData

Отвечает за хранение и валидацию данных заказа
Конструктор класса принимает инстанс брокера событий.

###### Поля класса

- events: IEvents – экземпляр класса EventEmitter для инициализации событий при изменении данных
– email: string, phone: string, address: string, payment: TPayment – данные, вводимые пользователем для заказа

###### Методы класса

- setData(data:Partial<IOrder>):void – обновляет хранимые в классе данные заказа и генерирует событие
- validatePayment(): {valid: boolean, error: string} – валидация данных оплаты
- validateContacts(): {valid: boolean, error: string} – валидация контактных данных

## Слой Представления

#### Базовый Класс Component

Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Class Modal

Реализует универсальное модальное окно. Устанавливает слушатели на клавиатуру для закрытия окна по Esc, на клик в оверлей и кнопку-крестик для закрытия окна.
Конструктор принимает контейнер модального окна, а также инстанс EventEmitter для возможности инициализации событий.

###### Поля класса

- content: HTMLElement – контейнер для содержимого модального окна
- closeButton: HTMLButtonElement – кнопка закрытия модального окна
- events: IEvents – экземпляр класса EventEmitter для инициализации событий

###### Методы класса

- open():void – открывает модальное окно и устанавлиет слушатель на Escape
- close():void – закрывает модальное окно, удаляет слушатель Escape и генерирует событие
- handleEscUp():void – обработчик события нажатия на Escape
- сеттер для поля content


#### Class Card

Представляет одну карточку товара в каталоге, в модальном окне карточки товара или в модальном окне корзины.
Добавляет слушатели на клик на элемент карточки в каталоге и слушатель на кнопку "В корзину", вызывая соответствующие события.
Конструктор: Принимает template: HTMLTemplateElement для клонирования и экземпляр класса EventEmitter для возможности инициализации событий.

###### Поля класса

- id: string;
- title: HTMLElement, description?: HTMLElement, image?: HTMLImageElement, price: HTMLElement, category?: HTMLElement – элементы для отображения данных товара.
– cartButton : HTMLButtonElement – кнопка добавления/удаления из корзины в модальном окне с карточкой товара или кнопка удаления из корзины в модальном окне с корзиной.
- events: IEvents – экземпляр класса EventEmitter для инициализации событий

###### Методы

- Сеттеры для id, title, description, image, price, category: Устанавливают соответствующие данные в DOM-элементы и управляет логикой отображения в зависимости от полученных данных.
- updateCartButton(isInCart: boolean): Управляет состоянием кнопки "В корзину".

#### Class Page

Отображает каталог товаров, а также иконку корзины в шапке сайта со счетчиком товаров. Устанавливает слушатель на нажатие по иконке корзины и генерирует событие.
Конструктор принимает контейнер page, а также экземпляр класса EventEmitter для возможности инициализации событий.

###### Поля класса

- catalog: HTMLElement[] – массив карточек товаров
- cardsContainer: HTMLElement[] – контейнер для галереи карточек товаров
- basketButton: HTMLElement[] - кнопка-иконка корзины в шапке
- counter: HTMLElement – элемент-счётчик товаров в корзине
- events: IEvents – экземпляр класса EventEmitter для инициализации событий

###### Методы класса

- setCards (items:HTMLElement[]) – устанавливает список DOM-элементов товаров в каталоге
- сеттер для обновления значения счетчика.

#### Class Cart

Реализует представление корзины в модальном окне. Устанавливает слушатель на кнопку оформления заказа и вызывает событие.
Конструктор принимает template и экземпляр EventEmitter.

###### Поля класса

- events: IEvents – экземпляр EventEmitter.
- cartCatalog: HTMLElement[] – массив карточек товаров
- total: HTMLElement – элемент с итоговой стоимостью товаров
- submitButton: HTMLButtonElement – кнопка оформления заказа

###### Методы класса

- toggleSubmitButton(value: number) – делает кнопку неактивной, если нет товаров в корзине, и наоборот.
- сеттеры и геттеры для полей класса
– setCards(items: HTMLElement[]): Устанавливает список DOM-элементов товаров в корзине. Если корзина пуста, отображает соответствующее сообщение.

#### Сlass Form

Реализует отображение форм в модальном окне. Устанавливает слушатели на поля ввода формы. При изменении данных в полях ввода инициирует событие изменения данных, передавая объект с данными. При сабмите инициирует именное событие (используя имя формы) для реализации различных сценариев. Предоставляет методы для отображения ошибок и управления активностью кнопки сабмита.
Конструктор принимает template и экземпляр EventEmitter.

###### Поля класса

- submitButton – кнопка отправки формы
- inputs: NodeListOf<HTMLInputElement> - инпут-элементы формы
- errors: HTMLElement - элемент для отображения ошибок
- formName:string - название формы

###### Методы класса

- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения
– getInputValues(): Record<string, string> – возвращает объект с данными из полей формы, где ключ – имя инпута, значение – данные, введенные пользователем.
- showInputError(errorMessage: string): void – отображает полученный текст ошибки.
- hideInputError(): void – очищает текст ошибки
- clear (): void - очищает поля формы, сообщения об ошибках и деактивирует кнопку сохранения

#### Class OrderForm extends Form

Отображает форму с выбором способа оплаты. Расширяет класс Form, добавляя кнопки выбора способа оплаты, слушатели к ним, генерирующие соответсвующее событие, а также метод устанавливающий состояние этих кнопок.

###### Поля класса

- offlineButton: HTMLButtonElement,
- onlineButton: HTMLButtonElement – кнопки выбора способа оплаты

###### Методы класса
- setPaymentMethod(method: TPayment): void

#### Class Success

Реализует сообщение об успешном оформлении заказа внутри модального окна.
Конструктор принимает template.

###### Поля класса

total:HTMLElement – элемент с итоговой стоимостью заказа

###### Методы класса

- сеттеры и геттеры для полей класса

## Слой коммуникации

#### Class AppAPI

Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

_Список всех событий, которые могут генерироваться в системе:_\
_События изменения данных (генерируются классами моделями данных)_

- `cards:changed` – изменение массива товаров
- `card:selected` - изменение открываемого в модальном окне товара
- `card:previewClear` - необходима очистка данных выбранной для показа в
  модальном окне карточки
- `cart:changed` – изменение корзины
- `order:changed` - изменение данных заказа

_События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)_

- `modal:close` – закрытие модального окна
- `card:select` – при нажатии на товар в каталоге
- `card:cart` - при нажатии на кнопку добавления или удаления из корзины
- `cart:open` - открытие модального окна с корзиной
- `cart:submit` - при нажатии на оформление заказа
- `order:input` - изменение данных в полях ввода формы выбора оплаты
- `order-payment:changed` - изменение способа оплаты в форме
- `contacts:input` - изменение данных в полях ввода формы контактных данных
- `order:submit` - при нажатии на submit в форме выбора способа оплаты. Презентер открывает форму контактов.
- `contacts:submit` - при нажатии на submit в форме контактных данных. Данные всего заказа из модели данных отправляются на сервер.
- `success:submit` - при нажатии кнопки "К новым покупкам"
